---
title: "SQL"
output: html_document
---

## Filtering Rows and Columns

with SQL you can filter columns with SELECT and rows with WHERE. Lets look at an example using the Lahman baseball database. First, we need to load some packages.

```{r warning=FALSE, message=FALSE}
library(Lahman)
library(sqldf)
```


Suppose we want to see the homerun totals for the 1927 Yankees. We could write the following:


```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='NYA'and yearID=1927"
sqldf(query)
```


This query identifies players on the NY Yankees team who have hit 40 or more homeruns and had less than 60 strike outs


```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting
WHERE teamID='NYA' and HR>=40 and SO<60"
sqldf(query)
```


This query broadens the search to players, on any team in the MLB, who have more than 40 homeruns and less than 60 strikeouts


```{r}
query<-"SELECT playerID,teamID,yearID,HR,SO FROM Batting
WHERE HR>40 and SO<60"
sqldf(query)
```


This query retrains the search to players on the Phillies team who have more than 30 homeruns during the 70s


```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting
WHERE teamID='PHI' and HR>30 and yearID<=1979 and yearID>=1970"
sqldf(query)
```

#------------------------------------------------------------------------

## Ordering Data Outputs

This query again widens the search to players, in desceding order, who have more than 50 homeruns


```{r}
query<-"SELECT playerID, yearID, teamID,HR FROM Batting
WHERE HR>50
ORDER BY HR DESC"
sqldf(query)
```


This query identified players, on any team in the MLB, that have had a season with at least 400 at bats and less than 10 strikeouts. In this case, it is in ascending order from those with the least strikeouts to the most.


```{r}
query<-"SELECT playerID,yearID,teamID,SO,AB FROM Batting
WHERE SO<10 and AB>=400
ORDER BY SO"
sqldf(query)
```

#------------------------------------------------------------------------


##Aggregation

```{r}
query<-"SELECT playerID, sum(HR) FROM Batting
WHERE playerID= 'ruthba01'
GROUP BY playerID"
sqldf(query)
```

```{r}
query<-"SELECT playerID, sum(HR) From Batting
GROUP BY playerID
HAVING sum(HR)>600
ORDER BY sum(HR) DESC"
sqldf(query)
```

```{r}
query<-"SELECT playerID, avg(HR) From Batting
GROUP BY playerID
HAVING avg(HR)>30
ORDER BY avg(HR) DESC"
sqldf(query)
```

#------------------------------------------------------------------------


## Joins

```{r}
query<-"SELECT nameFirst,nameLast,yearID,teamID,HR 
FROM Batting INNER JOIN Master
ON BATTING.playerID=Master.playerID
WHERE Batting.playerID= 'ruthba01'"
sqldf(query)
```

```{r}
query<-"SELECT nameFirst,nameLast,yearID,teamID,HR
FROM Batting INNER JOIN Master
ON BATTING.playerID=Master.playerID
WHERE Batting.HR>50
ORDER BY HR DESC"
sqldf(query)
```

```{r}
query<-"SELECT playerID,name,Batting.yearID,Batting.HR
FROM Batting INNER JOIN Teams
ON Batting.teamID=Teams.teamID AND Batting.yearID=Teams.yearID
WHERE playerID='ruthba01'"
sqldf(query)
```

